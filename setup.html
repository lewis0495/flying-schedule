<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flying Schedule - Setup</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #flightsContainer {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* Ensures 3 columns */
    gap: 30px; /* Increases spacing between boxes */
    max-width: 1000px;
    margin-top: 20px;
    align-items: start; /* Ensures alignment to the top */
}

        .flight { 
            width: 600px; 
            border: 1px solid #ccc; 
            padding: 10px; 
            margin: 10px 0; 
            background: #f9f9f9;
        }

        .flight-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 8px;
        }

        .flight-row .pair {
            display: flex;
            flex-direction: column;
            width: 48%;
        }

        .full-width { width: 100%; }

        label {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        input, select {
            font-size: 16px;
            padding: 6px;
            width: 100%;
            margin-bottom: 10px;
        }
        .addFlightBtn {
    background-color: #4CAF50; /* Green for add flight */
    color: white;
}

.addFlightBtn:hover {
    background-color: #0a6d3d; /* Darker green on hover */
}

        .deleteButton {
            background-color: #f44336;
            padding: 10px 20px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
            color: white;

        }

        .deleteButton:hover { background-color: black; }

        button {
    padding: 10px 20px;   /* Add consistent padding */
    font-size: 16px;       /* Ensure both buttons have the same font size */
    border-radius: 5px;    /* Rounded corners */
    cursor: pointer;      /* Pointer cursor on hover */
    border: none;          /* Remove default border */
    display: inline-block; /* Ensure buttons are inline but behave like block elements */
    text-align: center;    /* Center the text inside the button */
}

        #saveScheduleBtn { background-color: #4CAF50; }
        #addFlightBtn { background-color: #007BFF; }

        /* Animation styles */
        .animating {
            animation: scaleAnimation 0.3s ease-out;
        }

       /* Animation styles */
@keyframes scaleAnimation {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1); /* Slightly enlarge the button */
    }
    100% {
        transform: scale(1); /* Return to original size */
    }
}
        #updateMessage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            text-align: center;
            font-size: 18px;
            z-index: 9999;
        }
        #deleteAllBtn {
    background-color: #f44336; /* Red color for delete */
    color: white;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    border: none;
    cursor: pointer;
    margin-bottom: 20px;
}

#deleteAllBtn:hover {
    background-color: #000000; /* Darker red on hover */
}

    </style>
</head>
<body>
<div id="updateMessage">Flying schedule updated!</div>
    <a href="">Go to Schedule</a>
<h1>Flying Schedule Setup</h1>
<button id="saveScheduleBtn" onclick="saveFlightsToJsonBin(); saveScheduleAnimation();">UPDATE SCHEDULE</button>
<button id="deleteAllBtn" onclick="handleDeleteAllClick()">Delete All Flights</button>
<div id="flightsContainer"></div>
<button id="addFlightBtn" onclick="addFlight()" style="display: none;">Add Flight</button>

<script>
    let flights = JSON.parse(localStorage.getItem("setupFlights")) || [];
let pilots = JSON.parse(localStorage.getItem("pilots")) || ["John Doe", "Jane Smith"];

function createFlightElement(index, flight) {
    // (this part remains unchanged, so you can keep the createFlightElement() function you already have)
}

function renderFlights() {
    const flightsContainer = document.getElementById("flightsContainer");
    flightsContainer.innerHTML = ""; // Clear existing flights

    flights.forEach((flight, index) => {
        const flightElement = createFlightElement(index, flight);
        flightsContainer.appendChild(flightElement);
    });

    const addFlightBtn = document.getElementById("addFlightBtn");
    if (flights.length === 0) {
        addFlightBtn.style.display = "inline-block";
    } else {
        addFlightBtn.style.display = "none";
    }
}

function addFlight() {
    flights.push({
        aircraft: "",
        category: "",
        route: "",
        passengersOut: 0,
        passengersIn: 0,
        startTime: "",
        endTime: "",
        pilot1: "Pilot",
        pilot2: "Pilot",
        status: "Normal"
    });
    saveSetupFlightsToLocalStorage();  // Save to local storage
    renderFlights();
}

function updateFlight(index, key, value) {
    flights[index][key] = value;
    saveSetupFlightsToLocalStorage();  // Save to local storage
}

function deleteFlight(index) {
    flights.splice(index, 1);
    saveSetupFlightsToLocalStorage();  // Save to local storage
    renderFlights();
}

function saveSetupFlightsToLocalStorage() {
    localStorage.setItem("setupFlights", JSON.stringify(flights));
}

function saveFlightsToJsonBin() {
    const flightsData = JSON.stringify(flights);

    const apiKey = '$2a$10$QIHX2qKPoMahglyME0MgAeTiXF3E.LlehNOcwiCpU1k4RhzM7snOm';
    const binId = '67caea5ee41b4d34e4a26377';

    fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': apiKey,
        },
        body: flightsData,
    })
    .then(response => response.json())
    .then(data => {
        console.log("Data saved to JSONBin:", data);
        showUpdateMessage();
    })
    .catch(error => {
        console.error("Error saving data to JSONBin:", error);
    });
}

function saveScheduleAnimation() {
    const saveButton = document.getElementById("saveScheduleBtn");
    saveButton.classList.add("animating");

    setTimeout(() => saveButton.classList.remove("animating"), 300); // Matches animation duration
}

function showUpdateMessage() {
    const message = document.getElementById('updateMessage');
    message.style.display = 'block';
    setTimeout(() => message.style.display = 'none', 3000);
}

function handleDeleteClick(index, button) {
    if (button.innerText === "Click to confirm") {
        deleteFlight(index);
    } else {
        button.innerText = "Click to confirm";
        setTimeout(() => button.innerText = "Delete Flight", 3000);
    }
}

// Optional: Confirm delete all functionality (unchanged from your code)
let isDeleteAllConfirmed = false;

function handleDeleteAllClick() {
    const deleteAllBtn = document.getElementById("deleteAllBtn");

    if (!isDeleteAllConfirmed) {
        deleteAllBtn.textContent = "Click to Confirm";
        isDeleteAllConfirmed = true;

        setTimeout(() => {
            if (isDeleteAllConfirmed) {
                deleteAllBtn.textContent = "Delete All Flights";
                isDeleteAllConfirmed = false;
            }
        }, 5000);
    } else {
        const confirmation = window.confirm("Are you sure you want to delete all flights? This action cannot be undone.");
        if (confirmation) {
            deleteAllFlights();
        } else {
            deleteAllBtn.textContent = "Delete All Flights";
            isDeleteAllConfirmed = false;
        }
    }
}

function deleteAllFlights() {
    flights = [];
    saveSetupFlightsToLocalStorage();
    renderFlights();
    const deleteAllBtn = document.getElementById("deleteAllBtn");
    deleteAllBtn.textContent = "Delete All Flights";
    isDeleteAllConfirmed = false;
}

// Time formatting helper - no changes needed
function formatTimeInput(input) {
    let value = input.value.replace(/[^0-9:]/g, '');

    if (value === '') {
        input.value = '';
        return;
    }

    if (value.length === 2 && value.includes(':')) {
        value = value.replace(':', '');
    }

    if (value.length >= 3 && !value.includes(':')) {
        value = value.slice(0, 2) + ':' + value.slice(2);
    }

    if (value.length > 5) {
        value = value.slice(0, 5);
    }

    let parts = value.split(':');
    if (parts.length === 2 && parts[1].length === 2) {
        let hours = parseInt(parts[0], 10);
        let minutes = parseInt(parts[1], 10);

        if (hours > 23) hours = 23;
        if (minutes > 59) minutes = 59;

        value = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    }

    input.value = value;
}

// Initial load
renderFlights();
</script>
</body>
</html>
